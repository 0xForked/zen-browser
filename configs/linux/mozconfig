ac_add_options --enable-wasm-avx

# not when cross compiling
if ! test "$ZEN_CROSS_COMPILING"; then
    if test "$ZEN_RELEASE"; then
        export RUSTFLAGS="$RUSTFLAGS -Ctarget-cpu=x86-64-v3"
    fi

    if test -d "$HOME/.mozbuild/clang/bin"; then
        export CC="$HOME"/.mozbuild/clang/bin/clang
        export CXX="$HOME"/.mozbuild/clang/bin/clang++
    else
        export CC=clang
        export CXX=clang++
    fi

    ac_add_options --enable-linker=lld
fi

if test "$ZEN_RELEASE"; then
    ac_add_options --enable-strip
    export STRIP_FLAGS="--strip-debug --strip-unneeded"

    mk_add_options 'export RUSTC_WRAPPER=/home/runner/.mozbuild/sccache/sccache'
    mk_add_options 'export CCACHE_CPP2=yes'
    ac_add_options --with-ccache=/home/runner/.mozbuild/sccache/sccache
    mk_add_options 'export SCCACHE_GHA_ENABLED=on'
    
    # PGO may cause link errors on windows!
    if ! test "$ZEN_CROSS_COMPILING"; then
        # WE ARE JUST SUPPORTING PGO FOR LINUX!
        export MOZ_PGO=1
        ac_add_options MOZ_PGO=1
    fi
fi

# Disable telemetry and tracking
mk_add_options MOZ_TELEMETRY_REPORTING=
mk_add_options MOZ_DATA_REPORTING=
