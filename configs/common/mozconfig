
# Browser branding
ac_add_options --enable-update-channel=release

ac_add_options --with-app-name=${binName}
ac_add_options --with-app-basename=Zen

export MOZ_USER_DIR="${name}"
export MOZ_APP_VENDOR="${vendor}"
export MOZ_APP_BASENAME=Zen
export MOZ_APP_PROFILE=${binName}
export MOZ_APP_DISPLAYNAME="${name}"
export MOZ_BRANDING_DIRECTORY=${brandingDir}
export MOZ_OFFICIAL_BRANDING_DIRECTORY=${brandingDir}
export MOZ_MACBUNDLE_ID=${appId}
export MOZ_DISTRIBUTION_ID=${appId}
export MOZ_MACBUNDLE_NAME="Zen Browser.app"

# Uncomment if builds are too resource hungry
# mk_add_options MOZ_MAKE_FLAGS="-j4"
# ac_add_options --enable-linker=gold

# Misc
export MOZ_STUB_INSTALLER=1
export MOZ_SOURCE_REPO=https://github.com/zen-browser/desktop
export MOZ_SOURCE_CHANGESET=${changeset}
export MOZ_INCLUDE_SOURCE_INFO=1

ac_add_options --enable-bootstrap

ac_add_options --enable-application=browser

if test "$ZEN_RELEASE"; then
  ac_add_options --enable-optimize
  ac_add_options --enable-release
  ac_add_options --disable-debug
  ac_add_options --disable-debug-symbols
  ac_add_options --disable-debug-js-modules
  ac_add_options --disable-tests
  ac_add_options --enable-strip
  ac_add_options --enable-install-strip
  
  ac_add_options --enable-rust-simd
  ac_add_options --disable-parental-controls
  ac_add_options --disable-crashreporter
  mk_add_options MOZ_PARALLEL_COMPILE=1
  mk_add_options MOZ_CRASHREPORTER=0
  mk_add_options MOZ_DATA_REPORTING=0
  mk_add_options MOZ_SERVICES_HEALTHREPORT=0
  mk_add_options MOZ_TELEMETRY_REPORTING=0
  
  ac_add_options --enable-hardening
  ac_add_options --enable-sandbox

  ac_add_options --disable-crashreporter
  ac_add_options --disable-dmd
  ac_add_options --disable-geckodriver
  ac_add_options --disable-profiling
  ac_add_options --disable-rust-tests

  export MOZ_LTO=full
  ac_add_options MOZ_LTO=full
  ac_add_options --enable-lto=full

  if test "$ZEN_CROSS_COMPILING"; then
    ac_add_options --disable-jemalloc
  else
    ac_add_options --enable-jemalloc
  fi

  mk_add_options MOZILLA_OFFICIAL=1
  MOZILLA_OFFICIAL=1
  export MOZILLA_OFFICIAL=1

  mk_add_options MOZ_OPTIMIZE=1
  MOZ_OPTIMIZE=1
  export MOZ_OPTIMIZE=1

  export OPT_LEVEL="3"
  ac_add_options OPT_LEVEL="3"
  export RUSTC_OPT_LEVEL="3"
  ac_add_options RUSTC_OPT_LEVEL="3"

  # PGO may cause link errors on windows!
  if ! test "$ZEN_CROSS_COMPILING"; then
    export MOZ_PGO=1
    ac_add_options MOZ_PGO=1
  fi

  mk_add_options 'export RUSTC_WRAPPER=/home/runner/.mozbuild/sccache/sccache'
  mk_add_options 'export CCACHE_CPP2=yes'
  ac_add_options --with-ccache=/home/runner/.mozbuild/sccache/sccache
  mk_add_options 'export SCCACHE_GHA_ENABLED=on'
fi

ac_add_options --enable-unverified-updates
ac_add_options --enable-updater

ac_add_options --enable-raw
ac_add_options --enable-webrtc
ac_add_options --enable-jxl
ac_add_options --enable-av1
ac_add_options --enable-eme=widevine

export MOZ_REQUIRE_SIGNING=
export MOZ_TELEMETRY_REPORTING=

if test "$ZEN_CROSS_COMPILING"; then
  ac_add_options --target=x86_64-pc-linux-gnu
fi

export MOZ_APP_UA_NAME="Firefox"

# ALWAYS MANTAIN ONE LINE BREAK AT THE END OF THIS FILE